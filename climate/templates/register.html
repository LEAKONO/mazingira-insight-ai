{% extends 'base.html' %}
{% load static %}

{% block title %}Register - {{ menu_translations.app_name }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header text-center">
                <h4 class="mb-0">
                    <i class="fas fa-user-plus me-2"></i>
                    {{ menu_translations.register }}
                </h4>
            </div>
            <div class="card-body">
                <form method="post" id="registrationForm">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Please correct the errors below.
                    </div>
                    {% endif %}
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="id_username" class="form-label">
                                <i class="fas fa-user me-1"></i>Username
                            </label>
                            {{ form.username }}
                            {% if form.username.errors %}
                            <div class="text-danger small">{{ form.username.errors }}</div>
                            {% endif %}
                            <div class="form-text">Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="id_email" class="form-label">
                                <i class="fas fa-envelope me-1"></i>Email Address
                            </label>
                            {{ form.email }}
                            {% if form.email.errors %}
                            <div class="text-danger small">{{ form.email.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="id_first_name" class="form-label">
                                <i class="fas fa-user-circle me-1"></i>First Name
                            </label>
                            {{ form.first_name }}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="id_last_name" class="form-label">
                                <i class="fas fa-user-circle me-1"></i>Last Name
                            </label>
                            {{ form.last_name }}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_organization" class="form-label">
                            <i class="fas fa-building me-1"></i>Organization (Optional)
                        </label>
                        {{ form.organization }}
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="id_password1" class="form-label">
                                <i class="fas fa-lock me-1"></i>Password
                            </label>
                            {{ form.password1 }}
                            {% if form.password1.errors %}
                            <div class="text-danger small">{{ form.password1.errors }}</div>
                            {% endif %}
                            <div class="form-text">
                                <ul class="small">
                                    <li>Your password can't be too similar to your other personal information.</li>
                                    <li>Your password must contain at least 8 characters.</li>
                                    <li>Your password can't be a commonly used password.</li>
                                    <li>Your password can't be entirely numeric.</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <label for="id_password2" class="form-label">
                                <i class="fas fa-lock me-1"></i>Confirm Password
                            </label>
                            {{ form.password2 }}
                            {% if form.password2.errors %}
                            <div class="text-danger small">{{ form.password2.errors }}</div>
                            {% endif %}
                            <div class="form-text">Enter the same password as before, for verification.</div>
                        </div>
                    </div>
                    
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                        <label class="form-check-label" for="agreeTerms">
                            I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> and 
                            <a href="#" class="text-decoration-none">Privacy Policy</a>
                        </label>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </button>
                        <a href="{% url 'login' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-sign-in-alt me-2"></i>Already have an account? Login
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Features Card -->
        <div class="card mt-4">
            <div class="card-body">
                <h5><i class="fas fa-star me-2"></i>Why Register?</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex mb-3">
                            <div class="me-3">
                                <i class="fas fa-chart-line fa-2x text-primary"></i>
                            </div>
                            <div>
                                <h6>Personalized Dashboard</h6>
                                <p class="text-muted small">Track your region's climate data and get custom insights.</p>
                            </div>
                        </div>
                        
                        <div class="d-flex mb-3">
                            <div class="me-3">
                                <i class="fas fa-calculator fa-2x text-success"></i>
                            </div>
                            <div>
                                <h6>Carbon Calculator</h6>
                                <p class="text-muted small">Calculate and track your carbon footprint over time.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="d-flex mb-3">
                            <div class="me-3">
                                <i class="fas fa-flag fa-2x text-warning"></i>
                            </div>
                            <div>
                                <h6>Environmental Reports</h6>
                                <p class="text-muted small">Submit and track environmental issues in your area.</p>
                            </div>
                        </div>
                        
                        <div class="d-flex mb-3">
                            <div class="me-3">
                                <i class="fas fa-bell fa-2x text-danger"></i>
                            </div>
                            <div>
                                <h6>Climate Alerts</h6>
                                <p class="text-muted small">Get notified about extreme weather events in your region.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Password strength indicator
    document.getElementById('id_password1')?.addEventListener('input', function() {
        const password = this.value;
        const strengthIndicator = document.getElementById('passwordStrength');
        
        if (!strengthIndicator) {
            const indicator = document.createElement('div');
            indicator.id = 'passwordStrength';
            indicator.className = 'mt-2';
            this.parentElement.appendChild(indicator);
        }
        
        let strength = 0;
        let message = '';
        let color = 'danger';
        
        // Check password strength
        if (password.length >= 8) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        
        switch(strength) {
            case 0:
            case 1:
                message = 'Very Weak';
                color = 'danger';
                break;
            case 2:
                message = 'Weak';
                color = 'warning';
                break;
            case 3:
                message = 'Good';
                color = 'info';
                break;
            case 4:
                message = 'Strong';
                color = 'success';
                break;
        }
        
        document.getElementById('passwordStrength').innerHTML = `
            <div class="progress" style="height: 5px;">
                <div class="progress-bar bg-${color}" 
                     style="width: ${strength * 25}%">
                </div>
            </div>
            <small class="text-${color}">${message}</small>
        `;
    });
    
    // Password visibility toggle
    const passwordFields = document.querySelectorAll('input[type="password"]');
    passwordFields.forEach(field => {
        const toggleBtn = document.createElement('button');
        toggleBtn.type = 'button';
        toggleBtn.className = 'btn btn-sm btn-outline-secondary';
        toggleBtn.style.cssText = 'position: absolute; right: 10px; top: 50%; transform: translateY(-50%);';
        toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
        
        field.parentElement.style.position = 'relative';
        field.parentElement.appendChild(toggleBtn);
        
        toggleBtn.addEventListener('click', function() {
            const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
            field.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        });
    });
</script>
{% endblock %}